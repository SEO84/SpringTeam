<!doctype html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/base.html}">

<head>
    <style>
        .review-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
        }
        .profile-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #f0f0f0;
            margin-bottom: 20px;
        }
        .review-text {
            font-size: 1rem;
            margin-bottom: 20px;
        }
        .stars {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }
        .review-box {
            background-color: #f6f6f6;
            padding: 30px;
            width: 500px;
            border-radius: 10px;
            text-align: center;
        }
        .review-box textarea {
            width: 90%;
            height: 100px;
            margin-top: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .button-group {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }
        .btn {
            padding: 10px 40px;
            margin: 0 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1rem;
        }
        .btn.cancel {
            background-color: #d1d1d1;
        }
        .btn.submit {
            background-color: #000;
            color: white;
        }
        .form-select {
            width: 100%;
            max-width: 250px;
        }
    </style>
</head>

<body>
<div class="container" layout:fragment="content">
    <div class="review-container">
        <div class="profile-circle">
            <img th:src="${user.profilePicture != null ? user.profilePicture : '/images/default-profile.png'}"
                 alt="프로필" class="w-100 h-100 rounded-circle">
        </div>
        <p class="review-text">
            <strong th:text="${user.name != null ? user.name : 'Guest'}"></strong>님과 매칭은 어떠셨나요?
        </p>
        <div class="mb-3">
            <label for="rating" class="form-label">별점:</label>
            <select id="rating" class="form-select">
                <option value="5">★★★★★</option>
                <option value="4">★★★★☆</option>
                <option value="3">★★★☆☆</option>
                <option value="2">★★☆☆☆</option>
                <option value="1">★☆☆☆☆</option>
            </select>
        </div>
        <div class="review-box">
            <strong>리뷰를 남겨주세요</strong>
            <textarea placeholder="리뷰를 작성해 주세요."></textarea>
        </div>

        <div class="button-group">
            <button class="btn cancel">취소</button>
            <button class="btn submit">리뷰등록</button>
        </div>
    </div>
</div>

<script>
    document.querySelector('.btn.submit').onclick = function () {
        const rating = document.getElementById('rating').value;
        const comment = document.querySelector('.review-box textarea').value;

        const reviewData = {
            rating: rating,
            comment: comment,
            reviewed: { userId: 2 },
            matchingRoom: { id: 10 }
        };

        fetch('/reviews', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(reviewData)
        })
            .then(response => {
                if (response.ok) {
                    alert('리뷰가 성공적으로 작성되었습니다.');
                    window.location.reload();
                } else {
                    alert('리뷰 작성에 실패했습니다.');
                }
            })
            .catch(error => console.error('리뷰 제출 실패:', error));
    };
</script>
</body>
</html>
