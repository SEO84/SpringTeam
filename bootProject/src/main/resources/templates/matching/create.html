<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>매칭방 생성</title>
    <style>
        /* 기본 스타일 추가 */
        label {
            display: inline-block;
            width: 150px;
            margin-top: 10px;
        }
        input, textarea, select {
            width: 300px;
            padding: 5px;
            margin-top: 10px;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
        }
        .error-message {
            color: red;
            margin-top: 10px;
        }
        .pet-selection {
            margin-top: 10px;
        }
        .pet-selection label {
            width: 150px;
        }

        /* 모달 오버레이 */
        .modal {
            position: fixed; /* 화면 전체 덮기 */
            z-index: 9999;
            left: 0; top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4); /* 어두운 배경 */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 모달 내부 컨텐츠 박스 */
        .modal-content {
            background-color: #fff;
            padding: 20px;
            width: 400px;
            border-radius: 8px;
            position: relative;
        }

        /* 모달 닫기 버튼 */
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }

        /* 기타 폼 스타일은 기존과 동일, 필요시 추가 조정 */
    </style>
    <script th:inline="javascript">
        /*<![CDATA[*/
        // 서버에서 전달된 userPets 데이터를 JavaScript 변수로 변환
        var userPets = /*[[${userPets}]]*/ [];

        // 펫 추가 기능을 위한 JavaScript 함수
        function addPetSelection() {
            const container = document.getElementById('petSelections');

            // 새로운 펫 선택 필드 생성
            const petDiv = document.createElement('div');
            petDiv.classList.add('pet-selection');

            // 라벨 생성
            const label = document.createElement('label');
            label.innerText = '추가 펫:';

            // 셀렉트 박스 생성
            const select = document.createElement('select');
            select.name = 'additionalPetIds'; // 배열 형태로 받기 위해 이름 수정
            select.required = true;

            // 기본 옵션 추가
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.text = '-- 반려동물 선택 --';
            select.appendChild(defaultOption);

            // 서버에서 전달된 반려동물 목록을 기반으로 옵션 추가
            userPets.forEach(function(pet) {
                const option = document.createElement('option');
                option.value = pet.petId;
                option.textContent = pet.name;
                select.appendChild(option);
            });

            // 제거 버튼 생성
            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.innerText = '-';
            removeButton.onclick = function() { removePetSelection(removeButton); };

            // 펫 선택 필드에 라벨, 셀렉트 박스, 제거 버튼 추가
            petDiv.appendChild(label);
            petDiv.appendChild(select);
            petDiv.appendChild(removeButton);

            // 컨테이너에 새로운 펫 선택 필드 추가
            container.appendChild(petDiv);
        }

        // 펫 선택 필드 제거 함수
        function removePetSelection(button) {
            const petDiv = button.parentElement;
            petDiv.remove();
        }
        /*]]>*/
    </script>
</head>
<body>
<h1>매칭방 생성</h1>

<form th:action="@{/matching/create}" th:object="${matchingRoomDTO}" method="post">
    <label for="title">제목:</label>
    <input type="text" id="title" th:field="*{title}" required/>
    <div th:if="${#fields.hasErrors('title')}" th:errors="*{title}" class="error-message"></div><br/>

    <label for="description">설명:</label>
    <textarea id="description" th:field="*{description}" required></textarea>
    <div th:if="${#fields.hasErrors('description')}" th:errors="*{description}" class="error-message"></div><br/>

    <label for="place">장소:</label>
    <input type="text" id="place" th:field="*{place}" required/>
    <div th:if="${#fields.hasErrors('place')}" th:errors="*{place}" class="error-message"></div><br/>

    <label for="meetingDate">날짜:</label>
    <input type="date" id="meetingDate" th:field="*{meetingDate}" required/>
    <div th:if="${#fields.hasErrors('meetingDate')}" th:errors="*{meetingDate}" class="error-message"></div><br/>

    <label for="meetingTime">시간:</label>
    <input type="time" id="meetingTime" th:field="*{meetingTime}" required/>
    <div th:if="${#fields.hasErrors('meetingTime')}" th:errors="*{meetingTime}" class="error-message"></div><br/>

    <label for="maxParticipants">최대 인원:</label>
    <input type="number" id="maxParticipants" th:field="*{maxParticipants}" min="1" required/>
    <div th:if="${#fields.hasErrors('maxParticipants')}" th:errors="*{maxParticipants}" class="error-message"></div><br/>

    <!-- 방장의 반려동물 선택 드롭다운 추가 -->
    <label for="hostPet">방장의 반려동물:</label>
    <select id="hostPet" th:field="*{hostPetId}" required>
        <option value="">-- 반려동물 선택 --</option>
        <option th:each="pet : ${userPets}"
                th:value="${pet.petId}"
                th:text="${pet.name}">
        </option>
    </select>
    <div th:if="${#fields.hasErrors('hostPetId')}" th:errors="*{hostPetId}" class="error-message"></div><br/>

    <!-- 추가 펫 선택 섹션 -->
    <div id="petSelections"></div>
    <button type="button" onclick="addPetSelection()">펫 추가</button><br/><br/>

    <!-- 오류 메시지 표시 -->
    <div th:if="${errorMessage}" class="error-message" th:text="${errorMessage}"></div>

    <button type="submit">방 생성</button>
</form>

<p><a th:href="@{/matching/list}">[ 리스트로 돌아가기 ]</a></p>

<!-- 새 펫 등록 모달 -->
<div id="newPetModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span id="closeModalBtn" class="close-btn">&times;</span>
        <h2>새 반려동물 등록</h2>
        <form id="newPetForm">
            <label for="newPetName">이름:</label>
            <input type="text" id="newPetName" required/><br/>

            <label for="newPetType">종류:</label>
            <input type="text" id="newPetType" required/><br/>

            <label for="newPetAge">나이:</label>
            <input type="number" id="newPetAge" min="0" required/><br/>

            <label for="newPetGender">성별:</label>
            <select id="newPetGender" required>
                <option value="">-- 선택 --</option>
                <option value="MALE">남성</option>
                <option value="FEMALE">여성</option>
            </select><br/>

            <label for="newPetWeight">몸무게:</label>
            <input type="number" step="0.1" id="newPetWeight" min="0" required/><br/>

            <label for="newPetPersonality">성격:</label>
            <input type="text" id="newPetPersonality"/><br/>

            <button type="button" id="savePetBtn">저장</button>
        </form>
    </div>
</div>

<!-- JavaScript 파일 연결 (외부 파일로 분리하는 것을 권장) -->
<script th:src="@{/js/create.js}"></script>

</body>
</html>
