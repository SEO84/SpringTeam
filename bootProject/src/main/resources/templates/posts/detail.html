<!doctype html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/base.html}">
<body>
<div layout:fragment="content" class="container mt-5">
  <h2 class="mb-4" th:text="${post.title}">게시글 제목</h2>
  <p class="text-muted" th:text="'카테고리: ' + ${post.category}"></p>
  <p th:text="${post.content}">게시글 내용</p>
  <div class="mt-4">
    <a th:href="@{/posts(page=${currentPage})}" class="btn btn-secondary">목록으로</a>
    <a th:href="@{/posts/edit/{id}(id=${post.postId})}" class="btn btn-primary">수정</a>
  </div>

  <button class="btn btn-danger mt-3" id="deleteBtn" th:data-id="${post.postId}">삭제</button>

  <!-- 🟩 JavaScript 코드 삽입 -->
  <script>
    document.querySelector("#deleteBtn").onclick = function() {
      const postId = this.dataset.id;

      if (confirm("정말 삭제하시겠습니까?")) {
        fetch(`/posts/delete/${postId}`, {
          method: "DELETE"
        })
                .then(response => {
                  if (response.ok) {
                    alert("게시글이 삭제되었습니다.");
                    window.location.href = "/posts";
                  } else {
                    alert("삭제 실패: " + response.statusText);
                  }
                })
                .catch(error => {
                  console.error("Error:", error);
                  alert("오류가 발생했습니다.");
                });
      }
    };
  </script>
</div>
</body>
</html>
